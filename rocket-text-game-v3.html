<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rocket Text Game v3 - Enhanced Features</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .game-header {
            background: #2196f3;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .game-header h1 {
            margin: 0;
            font-size: 24px;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            padding: 10px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .info-item {
            font-size: 14px;
            color: #495057;
        }
        
        .info-item span {
            font-weight: bold;
            color: #007bff;
        }
        
        .game-textarea {
            width: 100%;
            height: 400px;
            border: none;
            outline: none;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            padding: 20px;
            box-sizing: border-box;
            resize: none;
            background: transparent;
            position: relative;
            z-index: 1;
            white-space: pre-wrap;
            overflow: auto;
            word-wrap: break-word;
            word-break: break-word;
        }
        
        .rocket {
            position: absolute;
            width: 20px;
            height: 20px;
            pointer-events: none;
            transition: none;
            z-index: 10;
            display: none;
        }
        
        .rocket-symbol {
            font-size: 20px;
            color: #ff4444;
            text-align: center;
            line-height: 20px;
            transform-origin: center;
            transition: opacity 0.1s ease;
        }
        
        .health-bar {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 150px;
            height: 15px;
            background-color: rgba(200, 200, 200, 0.5);
            border-radius: 7px;
            overflow: hidden;
            z-index: 20;
            display: none;
        }
        
        .health-fill {
            height: 100%;
            background-color: #4CAF50;
            transition: width 0.3s ease;
            width: 100%;
        }
        
        .points-display {
            position: absolute;
            color: #2196F3;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            pointer-events: none;
            z-index: 15;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            display: none;
            transition: transform 0.2s ease;
        }
        
        .instructions {
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #495057;
        }
        
        .instructions ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .instructions li {
            margin: 5px 0;
            color: #6c757d;
        }
        
        @keyframes rocket-blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .rocket.blinking .rocket-symbol {
            animation: rocket-blink 0.3s infinite;
        }
        
        @keyframes damage-fade {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }
        
        .damage-text {
            position: absolute;
            color: #ff4444;
            font-weight: bold;
            font-size: 12px;
            pointer-events: none;
            z-index: 25;
            animation: damage-fade 1s forwards;
        }
        
        .game-container.rocket-mode .game-textarea {
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="game-container" id="gameContainer">
        <div class="game-header">
            <h1>üöÄ Rocket Text Game v3</h1>
        </div>
        
        <div class="game-info">
            <div class="info-item">Health: <span id="healthValue">100</span>%</div>
            <div class="info-item">Points: <span id="pointsValue">0</span></div>
            <div class="info-item">Max Speed: <span id="maxSpeedValue">3</span></div>
            <div class="info-item">Status: <span id="statusValue">Ready</span></div>
        </div>
        
        <div style="position: relative;">
            <textarea class="game-textarea" id="gameTextarea" placeholder="Click here to start the game, or start typing...">
üöÄ Welcome to Rocket Text Game v3!

This enhanced version includes all the exciting new features:

üéØ SPEED SCALING
Your maximum speed increases as you earn points! Every 10 points adds 0.5 to your max speed, up to a maximum of 10.

üíî HEALTH AS OPACITY
Watch your rocket fade as it takes damage! The rocket becomes more transparent as health decreases, with dramatic flashing at critical levels.

üîÑ TEXT WRAPPING
Seamless wrapping both horizontally and vertically - when your rocket reaches any edge, it smoothly wraps around to the opposite side.

‚å®Ô∏è TYPING FRIENDLY
Type normally while playing! Arrow keys only control the rocket when in rocket mode - your regular typing is completely unaffected.

üìä DYNAMIC DISPLAY
The points display intelligently adjusts its position based on your acceleration and deceleration patterns.

üéÆ ENHANCED CONTROLS
The rocket never fully stops (minimum speed 0.5) and responds to three acceleration states: accelerating, cruising, and decelerating.

Try flying through the spaces and avoiding the letters. The rocket gets faster as you earn more points, making the game increasingly challenging!

Remember: Safe flight through spaces, tabs, and newlines will slowly regenerate your health. Collision with any letter reduces health.

The quick brown fox jumps over the lazy dog while packing boxes with five dozen liquor jugs. Amazingly few discotheques provide jukeboxes for wizards who make toxic brew for evil queens and jacks.

Type here freely - the arrow keys won't interfere until you activate rocket mode by clicking!
            </textarea>
            
            <div class="rocket" id="rocket">
                <div class="rocket-symbol">‚ñ≤</div>
            </div>
            
            <div class="health-bar" id="healthBar">
                <div class="health-fill" id="healthFill"></div>
            </div>
            
            <div class="points-display" id="pointsDisplay">0</div>
        </div>
        
        <div class="instructions">
            <h3>How to Play:</h3>
            <ul>
                <li><strong>Click</strong> on the text area to activate rocket mode</li>
                <li><strong>Arrow Keys:</strong> Up/Down for speed control, Left/Right for rotation</li>
                <li><strong>Escape</strong> to exit rocket mode</li>
                <li><strong>Type freely</strong> - arrow keys don't interfere with normal typing</li>
                <li><strong>Goal:</strong> Fly through spaces to gain points and regenerate health</li>
                <li><strong>Avoid:</strong> Colliding with letters reduces health</li>
            </ul>
        </div>
    </div>

    <script>
        class RocketTextGameV3Standalone {
            constructor() {
                this.container = document.getElementById('gameContainer');
                this.textarea = document.getElementById('gameTextarea');
                this.rocket = document.getElementById('rocket');
                this.healthBar = document.getElementById('healthBar');
                this.healthFill = document.getElementById('healthFill');
                this.pointsDisplay = document.getElementById('pointsDisplay');
                
                this.rocketMode = false;
                this.rocketX = 0;
                this.rocketY = 0;
                this.rocketSpeed = 0;
                this.rocketAngle = 0;
                this.baseMaxSpeed = 3;
                this.maxSpeed = 3;
                
                this.health = 100;
                this.maxHealth = 100;
                this.points = 0;
                this.safeFlightTime = 0;
                
                this.keys = {
                    ArrowUp: false,
                    ArrowDown: false,
                    ArrowLeft: false,
                    ArrowRight: false
                };
                
                this.animationId = null;
                this.blinkingTimeout = null;
                this.opacityInterval = null;
                
                this.lastSafeFlightTime = 0;
                this.acceleration = 0;
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                this.textarea.addEventListener('click', (e) => this.handleClick(e));
                document.addEventListener('keydown', (e) => this.handleKeyDown(e));
                document.addEventListener('keyup', (e) => this.handleKeyUp(e));
            }
            
            handleClick(e) {
                if (!this.rocketMode) {
                    this.activateRocketMode(e);
                } else {
                    this.updateRocketPosition(e);
                }
            }
            
            activateRocketMode(e) {
                this.rocketMode = true;
                this.container.classList.add('rocket-mode');
                this.rocket.style.display = 'block';
                this.healthBar.style.display = 'block';
                this.pointsDisplay.style.display = 'block';
                
                this.health = 100;
                this.points = 0;
                this.safeFlightTime = 0;
                this.lastSafeFlightTime = 0;
                this.acceleration = 0;
                
                this.updateRocketPosition(e);
                this.startGameLoop();
                this.updateStatus();
            }
            
            deactivateRocketMode() {
                this.rocketMode = false;
                this.container.classList.remove('rocket-mode');
                this.rocket.style.display = 'none';
                this.healthBar.style.display = 'none';
                this.pointsDisplay.style.display = 'none';
                this.stopGameLoop();
                
                if (this.blinkingTimeout) {
                    clearTimeout(this.blinkingTimeout);
                    this.blinkingTimeout = null;
                }
                
                if (this.opacityInterval) {
                    clearInterval(this.opacityInterval);
                    this.opacityInterval = null;
                }
                
                this.rocket.classList.remove('blinking');
                this.rocket.querySelector('.rocket-symbol').style.opacity = '1';
                this.updateStatus();
            }
            
            updateRocketPosition(e) {
                const rect = this.textarea.getBoundingClientRect();
                this.rocketX = e.clientX - rect.left;
                this.rocketY = e.clientY - rect.top;
                this.updateRocketDisplay();
            }
            
            handleKeyDown(e) {
                if (this.rocketMode && ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                    e.preventDefault();
                    this.keys[e.key] = true;
                }
            }
            
            handleKeyUp(e) {
                if (this.rocketMode && ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                    e.preventDefault();
                    this.keys[e.key] = false;
                }
                
                if (e.key === 'Escape' && this.rocketMode) {
                    this.deactivateRocketMode();
                }
            }
            
            startGameLoop() {
                if (!this.animationId) {
                    this.gameLoop();
                }
            }
            
            stopGameLoop() {
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                    this.animationId = null;
                }
            }
            
            gameLoop() {
                this.updateRocket();
                this.checkTextCollision();
                this.updatePoints();
                this.updateRocketDisplay();
                this.updatePointsDisplay();
                this.updateRocketOpacity();
                this.updateStatus();
                
                this.animationId = requestAnimationFrame(() => this.gameLoop());
            }
            
            updateRocket() {
                let isAccelerating = false;
                
                if (this.keys.ArrowLeft) {
                    this.rocketAngle = (this.rocketAngle - 5 + 360) % 360;
                }
                if (this.keys.ArrowRight) {
                    this.rocketAngle = (this.rocketAngle + 5) % 360;
                }
                
                if (this.keys.ArrowUp) {
                    this.rocketSpeed = Math.min(this.rocketSpeed + 0.2, this.maxSpeed);
                    isAccelerating = true;
                }
                if (this.keys.ArrowDown) {
                    this.rocketSpeed = Math.max(this.rocketSpeed - 0.2, 0.5);
                }
                
                this.acceleration = isAccelerating ? 1 : (this.rocketSpeed > 0.5 ? 0 : -1);
                
                const radians = (this.rocketAngle - 90) * Math.PI / 180;
                const deltaX = Math.cos(radians) * this.rocketSpeed;
                const deltaY = Math.sin(radians) * this.rocketSpeed;
                
                const rect = this.textarea.getBoundingClientRect();
                
                let newX = this.rocketX + deltaX;
                let newY = this.rocketY + deltaY;
                
                if (newX < 0) {
                    newX = rect.width - 20;
                } else if (newX > rect.width) {
                    newX = 0;
                }
                
                if (newY < 0) {
                    newY = rect.height - 20;
                } else if (newY > rect.height) {
                    newY = 0;
                }
                
                this.rocketX = newX;
                this.rocketY = newY;
            }
            
            checkTextCollision() {
                if (!this.rocketMode) return;
                
                const text = this.textarea.value;
                if (!text) return;
                
                const charPos = this.getCharPositionAt(this.rocketX, this.rocketY);
                if (charPos === null) return;
                
                const char = text[charPos];
                const isSafe = char === ' ' || char === '\t' || char === '\n';
                
                if (isSafe) {
                    this.health = Math.min(this.health + 0.5, this.maxHealth);
                } else {
                    this.takeDamage(2);
                }
            }
            
            getCharPositionAt(x, y) {
                const rect = this.textarea.getBoundingClientRect();
                
                const style = window.getComputedStyle(this.textarea);
                const fontSize = parseInt(style.fontSize);
                const lineHeight = fontSize * 1.4;
                const charWidth = fontSize * 0.6;
                
                const col = Math.floor(x / charWidth);
                const row = Math.floor(y / lineHeight);
                
                const lines = this.textarea.value.split('\n');
                if (row >= lines.length) return null;
                
                const line = lines[row];
                if (col >= line.length) return null;
                
                let charPos = 0;
                for (let i = 0; i < row; i++) {
                    charPos += lines[i].length + 1;
                }
                charPos += col;
                
                return charPos;
            }
            
            takeDamage(amount) {
                this.health -= amount;
                
                if (this.health <= 30 && !this.rocket.classList.contains('blinking')) {
                    this.rocket.classList.add('blinking');
                }
                
                if (this.health <= 0) {
                    this.deactivateRocketMode();
                }
            }
            
            updatePoints() {
                if (this.rocketSpeed > 0.5) {
                    this.safeFlightTime += 16;
                    this.points = Math.floor(this.safeFlightTime / 100);
                    
                    this.maxSpeed = this.baseMaxSpeed + Math.floor(this.points / 10) * 0.5;
                    this.maxSpeed = Math.min(this.maxSpeed, 10);
                }
            }
            
            updateRocketOpacity() {
                const opacity = this.health / 100;
                this.rocket.querySelector('.rocket-symbol').style.opacity = opacity.toString();
                
                if (this.health <= 10) {
                    if (!this.opacityInterval) {
                        this.opacityInterval = setInterval(() => {
                            const currentOpacity = parseFloat(this.rocket.querySelector('.rocket-symbol').style.opacity);
                            this.rocket.querySelector('.rocket-symbol').style.opacity = currentOpacity === 0 ? '0.5' : '0';
                        }, 200);
                    }
                } else if (this.opacityInterval) {
                    clearInterval(this.opacityInterval);
                    this.opacityInterval = null;
                }
            }
            
            updateRocketDisplay() {
                this.rocket.style.left = `${this.rocketX - 10}px`;
                this.rocket.style.top = `${this.rocketY - 10}px`;
                this.rocket.querySelector('.rocket-symbol').style.transform = `rotate(${this.rocketAngle}deg)`;
            }
            
            updatePointsDisplay() {
                this.pointsDisplay.textContent = this.points;
                
                let distance = 30 + (this.rocketSpeed * 10);
                
                if (this.acceleration > 0) {
                    distance += 15;
                } else if (this.acceleration < 0) {
                    distance -= 10;
                }
                
                const radians = (this.rocketAngle - 90) * Math.PI / 180;
                const offsetX = Math.cos(radians) * -distance;
                const offsetY = Math.sin(radians) * -distance;
                
                this.pointsDisplay.style.left = `${this.rocketX + offsetX - 10}px`;
                this.pointsDisplay.style.top = `${this.rocketY + offsetY - 10}px`;
                
                const scale = 1 + (this.rocketSpeed / this.maxSpeed) * 0.2;
                this.pointsDisplay.style.transform = `scale(${scale})`;
            }
            
            updateStatus() {
                document.getElementById('healthValue').textContent = Math.round(this.health);
                document.getElementById('pointsValue').textContent = this.points;
                document.getElementById('maxSpeedValue').textContent = this.maxSpeed.toFixed(1);
                document.getElementById('statusValue').textContent = this.rocketMode ? 'Active' : 'Ready';
            }
        }
        
        // Initialize the game when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new RocketTextGameV3Standalone();
        });
    </script>
</body>
</html>