<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rocket Text Game</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        
        .game-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .text-frame {
            position: relative;
            width: 100%;
            height: 400px;
            border: 2px solid #333;
            background-color: white;
            overflow: hidden;
            cursor: text;
        }
        
        .text-editor {
            width: 100%;
            height: 100%;
            border: none;
            outline: none;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            resize: none;
            box-sizing: border-box;
            background: transparent;
        }
        
        .rocket {
            position: absolute;
            width: 20px;
            height: 20px;
            pointer-events: none;
            transition: none;
            z-index: 10;
        }
        
        .rocket::before {
            content: '▲';
            display: block;
            font-size: 20px;
            color: #ff4444;
            text-align: center;
            line-height: 20px;
            transform-origin: center;
        }
        
        .info-panel {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background-color: rgba(200, 200, 200, 0.8);
            padding: 5px;
            font-size: 11px;
            font-family: 'Courier New', monospace;
            color: #333;
            border-radius: 3px;
            pointer-events: none;
            z-index: 20;
        }
        
        .info-panel div {
            margin: 2px 0;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Rocket Text Game</h1>
        <p>Click in the text area to activate rocket mode. Use arrow keys to control the rocket.</p>
        
        <div class="text-frame" id="gameFrame">
            <textarea class="text-editor" id="textEditor" placeholder="Start typing..."></textarea>
            <div class="rocket hidden" id="rocket"></div>
            <div class="info-panel" id="infoPanel">
                <div>Frame: <span id="frameSize">0x0</span></div>
                <div>Mouse: <span id="mousePos">0,0</span></div>
                <div>Rocket: <span id="rocketPos">0,0</span></div>
                <div>Speed: <span id="rocketSpeed">0</span></div>
                <div>Angle: <span id="rocketAngle">0°</span></div>
            </div>
        </div>
    </div>

    <script>
        class RocketTextGame {
            constructor() {
                this.gameFrame = document.getElementById('gameFrame');
                this.textEditor = document.getElementById('textEditor');
                this.rocket = document.getElementById('rocket');
                this.infoPanel = document.getElementById('infoPanel');
                
                this.rocketMode = false;
                this.rocketX = 0;
                this.rocketY = 0;
                this.rocketSpeed = 0;
                this.rocketAngle = 0; // 0 = up, 90 = right, 180 = down, 270 = left
                this.maxSpeed = 5;
                
                this.keys = {
                    ArrowUp: false,
                    ArrowDown: false,
                    ArrowLeft: false,
                    ArrowRight: false
                };
                
                this.animationId = null;
                
                this.init();
            }
            
            init() {
                // Focus text editor on load
                this.textEditor.focus();
                
                // Event listeners
                this.gameFrame.addEventListener('click', (e) => this.handleFrameClick(e));
                document.addEventListener('keydown', (e) => this.handleKeyDown(e));
                document.addEventListener('keyup', (e) => this.handleKeyUp(e));
                
                // Update info panel on mouse move
                this.gameFrame.addEventListener('mousemove', (e) => this.updateMouseInfo(e));
                
                // Update frame dimensions
                this.updateFrameInfo();
                window.addEventListener('resize', () => this.updateFrameInfo());
                
                // Check for text collision periodically
                setInterval(() => this.checkTextCollision(), 100);
            }
            
            handleFrameClick(e) {
                if (!this.rocketMode) {
                    this.activateRocketMode(e);
                } else {
                    this.updateRocketPosition(e);
                }
            }
            
            activateRocketMode(e) {
                this.rocketMode = true;
                this.textEditor.blur();
                this.rocket.classList.remove('hidden');
                
                this.updateRocketPosition(e);
                this.startGameLoop();
            }
            
            deactivateRocketMode() {
                this.rocketMode = false;
                this.rocket.classList.add('hidden');
                this.stopGameLoop();
                this.textEditor.focus();
            }
            
            updateRocketPosition(e) {
                const rect = this.gameFrame.getBoundingClientRect();
                this.rocketX = e.clientX - rect.left;
                this.rocketY = e.clientY - rect.top;
                this.updateRocketDisplay();
            }
            
            handleKeyDown(e) {
                if (this.rocketMode && ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                    e.preventDefault();
                    this.keys[e.key] = true;
                }
            }
            
            handleKeyUp(e) {
                if (this.rocketMode && ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                    e.preventDefault();
                    this.keys[e.key] = false;
                }
                
                // Exit rocket mode with Escape
                if (e.key === 'Escape' && this.rocketMode) {
                    this.deactivateRocketMode();
                }
            }
            
            startGameLoop() {
                if (!this.animationId) {
                    this.gameLoop();
                }
            }
            
            stopGameLoop() {
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                    this.animationId = null;
                }
            }
            
            gameLoop() {
                this.updateRocket();
                this.updateRocketDisplay();
                this.updateInfoPanel();
                
                this.animationId = requestAnimationFrame(() => this.gameLoop());
            }
            
            updateRocket() {
                // Handle rotation
                if (this.keys.ArrowLeft) {
                    this.rocketAngle = (this.rocketAngle - 5 + 360) % 360;
                }
                if (this.keys.ArrowRight) {
                    this.rocketAngle = (this.rocketAngle + 5) % 360;
                }
                
                // Handle speed
                if (this.keys.ArrowUp) {
                    this.rocketSpeed = Math.min(this.rocketSpeed + 0.2, this.maxSpeed);
                }
                if (this.keys.ArrowDown) {
                    this.rocketSpeed = Math.max(this.rocketSpeed - 0.2, 0);
                }
                
                // Calculate movement
                const radians = (this.rocketAngle - 90) * Math.PI / 180; // Adjust for upward being 0°
                const deltaX = Math.cos(radians) * this.rocketSpeed;
                const deltaY = Math.sin(radians) * this.rocketSpeed;
                
                // Update position with wrapping
                const frameRect = this.gameFrame.getBoundingClientRect();
                this.rocketX = (this.rocketX + deltaX + frameRect.width) % frameRect.width;
                this.rocketY = (this.rocketY + deltaY + frameRect.height) % frameRect.height;
            }
            
            updateRocketDisplay() {
                this.rocket.style.left = `${this.rocketX - 10}px`;
                this.rocket.style.top = `${this.rocketY - 10}px`;
                this.rocket.style.transform = `rotate(${this.rocketAngle}deg)`;
            }
            
            updateFrameInfo() {
                const rect = this.gameFrame.getBoundingClientRect();
                document.getElementById('frameSize').textContent = `${Math.round(rect.width)}x${Math.round(rect.height)}`;
            }
            
            updateMouseInfo(e) {
                if (this.rocketMode) {
                    const rect = this.gameFrame.getBoundingClientRect();
                    const x = Math.round(e.clientX - rect.left);
                    const y = Math.round(e.clientY - rect.top);
                    document.getElementById('mousePos').textContent = `${x},${y}`;
                }
            }
            
            updateInfoPanel() {
                document.getElementById('rocketPos').textContent = `${Math.round(this.rocketX)},${Math.round(this.rocketY)}`;
                document.getElementById('rocketSpeed').textContent = this.rocketSpeed.toFixed(1);
                document.getElementById('rocketAngle').textContent = `${this.rocketAngle}°`;
            }
            
            checkTextCollision() {
                if (!this.rocketMode) return;
                
                // Get text content and cursor position
                const text = this.textEditor.value;
                if (!text.trim()) return;
                
                // Get text editor metrics
                const editorRect = this.textEditor.getBoundingClientRect();
                const frameRect = this.gameFrame.getBoundingClientRect();
                
                // Calculate relative position
                const relX = this.rocketX - (editorRect.left - frameRect.left);
                const relY = this.rocketY - (editorRect.top - frameRect.top);
                
                // Simple collision detection based on text presence
                // This is a basic approximation - in a real implementation, you'd need
                // to measure actual text positions
                const charWidth = 8.4; // Approximate character width
                const lineHeight = 19.6; // Approximate line height
                
                const col = Math.floor(relX / charWidth);
                const row = Math.floor(relY / lineHeight);
                
                if (col >= 0 && row >= 0 && text[row * Math.floor(this.textEditor.cols) + col]) {
                    this.deactivateRocketMode();
                }
            }
        }
        
        // Initialize the game when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new RocketTextGame();
        });
    </script>
</body>
</html>